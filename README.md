# è¨Šæ¯è¨ˆæ•¸æ©Ÿå™¨äºº Pro (Message Counter Pro)

 <!-- å»ºè­°å¯ä»¥è‡ªå·±åšä¸€å€‹é…·ç‚«çš„æ©«å¹…åœ–ç‰‡ -->

**ä¸€å€‹ç‚º Discord ä¼ºæœå™¨æ‰“é€ çš„é«˜å¯é æ€§ã€é«˜æ•ˆç‡çš„è¨Šæ¯çµ±è¨ˆæ©Ÿå™¨äººã€‚æ¡ç”¨ TypeScript èˆ‡ PostgreSQLï¼Œå°ˆç‚ºä¸­å°å‹ç¤¾ç¾¤è¨­è¨ˆï¼Œå…·å‚™æ–·é»çºŒå‚³çš„æ­·å²è¨Šæ¯åŒæ­¥èƒ½åŠ›ã€‚**

[![Discord.js](https://img.shields.io/badge/Discord.js-v14-7289DA?style=for-the-badge&logo=discord&logoColor=white)](https://discord.js.org/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.x-3178C6?style=for-the-badge&logo=typescript&logoColor=white)](https://www.typescriptlang.org/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-16-336791?style=for-the-badge&logo=postgresql&logoColor=white)](https://www.postgresql.org/)
[![Node.js](https://img.shields.io/badge/Node.js-20.x-339933?style=for-the-badge&logo=nodedotjs&logoColor=white)](https://nodejs.org/)

---

## ğŸŒŸ æ ¸å¿ƒäº®é» (Core Features)

é€™å€‹æ©Ÿå™¨äººä¸åƒ…åƒ…æ˜¯å€‹è¨ˆæ•¸å™¨ï¼Œå®ƒçš„è¨­è¨ˆç†å¿µæ˜¯**ç©©å¥**èˆ‡**é«˜æ•ˆ**ã€‚

-   **âš¡ å³æ™‚çµ±è¨ˆ**: é€éäº‹ä»¶ç›£è½ï¼Œå³æ™‚ã€æº–ç¢ºåœ°æ•æ‰æ¯ä¸€æ¢æ–°è¨Šæ¯ã€‚
-   **ğŸ›¡ï¸ æ–·é»çºŒå‚³åŒæ­¥**: ç¨ç‰¹çš„æ­·å²è¨Šæ¯åŒæ­¥æ©Ÿåˆ¶ï¼Œå³ä½¿åœ¨åŒæ­¥æ•¸åè¬æ¢è¨Šæ¯çš„éç¨‹ä¸­æ„å¤–ä¸­æ–·ï¼Œä¸‹æ¬¡ä¹Ÿèƒ½å¾ä¸Šæ¬¡å®Œæˆçš„é »é“ç¹¼çºŒï¼Œç„¡éœ€å¾é ­å†ä¾†ã€‚
-   **ğŸ“Š ç²¾ç¾æ’è¡Œæ¦œ**: ä½¿ç”¨ Discord Embeds ç”Ÿæˆè¦–è¦ºåŒ–çš„è¨Šæ¯æ’è¡Œæ¦œï¼Œä¸€ç›®äº†ç„¶ã€‚
-   **âš™ï¸ ç‹€æ…‹è¿½è¹¤**: ç‚ºæ¯å€‹ä¼ºæœå™¨çš„åŒæ­¥ä»»å‹™ç¶­è­·ç‹€æ…‹ï¼Œé˜²æ­¢é‡è¤‡åŸ·è¡Œï¼Œä¿è­‰è³‡æ–™ä¸€è‡´æ€§ã€‚
-   **ğŸ’ª å°ˆæ¥­æ¶æ§‹**: æ¡ç”¨ TypeScript é€²è¡Œå¼·å‹åˆ¥é–‹ç™¼ï¼Œæ­é… PostgreSQL é€²è¡Œé«˜æ•ˆèƒ½è³‡æ–™å„²å­˜ï¼Œç¨‹å¼ç¢¼çµæ§‹æ¸…æ™°ã€æ˜“æ–¼æ“´å±•ã€‚

### ğŸ¤– åŠŸèƒ½å±•ç¤º (Features in Action)

| æŒ‡ä»¤ (Command) | æè¿° (Description) | é è¦½ (Preview) |
| :--------------- | :------------------- | :--------------- |
| `/leaderboard` | é¡¯ç¤ºä¼ºæœå™¨ä¸­æœ€æ´»èºçš„æˆå“¡æ’è¡Œæ¦œã€‚ |  <!-- å»ºè­°éŒ„è£½ä¸€å€‹ GIF å±•ç¤º --> |
| `/sync-messages` | **(åƒ…é™ç®¡ç†å“¡)** æ¸…ç†ä¸¦é‡æ–°åŒæ­¥ä¼ºæœå™¨æ‰€æœ‰æ­·å²è¨Šæ¯ã€‚å…·å‚™é«˜å®¹éŒ¯æ€§ï¼Œå³ä½¿ä¸­æ–·ä¹Ÿèƒ½æ¢å¾©ã€‚ |  <!-- å»ºè­°éŒ„è£½ä¸€å€‹ GIF å±•ç¤º --> |
| `/my-stats` | (å¯æ“´å……) æŸ¥è©¢ä½ è‡ªå·±çš„è¨Šæ¯æ•¸é‡ã€‚ | N/A |

---

## ğŸ›ï¸ æŠ€è¡“æ¶æ§‹ (Architecture)

æœ¬å°ˆæ¡ˆçš„è¨­è¨ˆæ ¸å¿ƒæ˜¯**æ¨¡çµ„åŒ–**èˆ‡**è³‡æ–™åº«é©…å‹•çš„ç‹€æ…‹ç®¡ç†**ã€‚

### è³‡æ–™åº«çµæ§‹

æˆ‘å€‘ä½¿ç”¨å…©å¼µè¡¨ä¾†ç²¾ç¢ºåœ°ç®¡ç†æ•¸æ“šèˆ‡ç‹€æ…‹ï¼š

1.  **`message_counts`**:
    -   ä»¥ `(user_id, guild_id, channel_id)` ç‚ºè¤‡åˆä¸»éµã€‚
    -   ç²¾ç´°åœ°è¨˜éŒ„æ¯å€‹ä½¿ç”¨è€…åœ¨**æ¯å€‹é »é“**çš„è¨Šæ¯æ•¸é‡ã€‚
    -   ç‚ºæ’è¡Œæ¦œçš„åŒ¯ç¸½æŸ¥è©¢å’Œé »é“ç´šçš„åŒæ­¥æ“ä½œæä¾›äº†åŸºç¤ã€‚

2.  **`sync_status`**:
    -   ä»¥ `guild_id` ç‚ºä¸»éµã€‚
    -   è¿½è¹¤ `/sync-messages` æŒ‡ä»¤çš„åŸ·è¡Œç‹€æ…‹ (`in_progress`, `completed`, `failed`)ã€‚
    -   **`last_synced_channel_id`** æ˜¯å¯¦ç¾æ–·é»çºŒå‚³çš„é—œéµæ¬„ä½ã€‚

### å®¹éŒ¯åŒæ­¥æµç¨‹ (`/sync-messages`)

 <!-- å»ºè­°ç•«ä¸€å€‹æµç¨‹åœ– -->

1.  **é–å®šç‹€æ…‹**: æŒ‡ä»¤é–‹å§‹æ™‚ï¼Œé–å®š `sync_status` è¡¨ï¼Œé˜²æ­¢é‡è¤‡åŸ·è¡Œã€‚
2.  **è®€å–é€²åº¦**: æª¢æŸ¥ `last_synced_channel_id`ï¼Œç¢ºå®šå¾å“ªå€‹é »é“é–‹å§‹ã€‚
3.  **é »é“ç´šå†ªç­‰æ“ä½œ**:
    -   **é–‹å§‹åŒæ­¥ä¸€å€‹é »é“å‰**: `DELETE` è©²é »é“åœ¨ `message_counts` ä¸­çš„æ‰€æœ‰è¨˜éŒ„ã€‚
    -   **æˆåŠŸåŒæ­¥ä¸€å€‹é »é“å¾Œ**: `UPDATE` `sync_status` è¡¨ï¼Œä¿å­˜ç•¶å‰é€²åº¦ã€‚
4.  **é‡‹æ”¾ç‹€æ…‹**: ä»»å‹™å…¨éƒ¨å®Œæˆæˆ–å¤±æ•—å¾Œï¼Œæ›´æ–°æœ€çµ‚ç‹€æ…‹ä¸¦é‡‹æ”¾é–ã€‚

---

## ğŸš€ é–‹å§‹ä½¿ç”¨ (Getting Started)

è«‹æŒ‰ç…§ä»¥ä¸‹æ­¥é©Ÿä¾†è¨­å®šå’Œå•Ÿå‹•ä½ è‡ªå·±çš„æ©Ÿå™¨äººå¯¦ä¾‹ã€‚

### 1. å…ˆæ±ºæ¢ä»¶ (Prerequisites)

-   [Node.js](https://nodejs.org/) (å»ºè­° v18 æˆ–æ›´é«˜ç‰ˆæœ¬)
-   [PostgreSQL](https://www.postgresql.org/download/) è³‡æ–™åº«ä¼ºæœå™¨
-   ä¸€å€‹ Discord æ©Ÿå™¨äººå¸³è™Ÿ (å¯å¾ [Discord Developer Portal](https://discord.com/developers/applications) å»ºç«‹)

### 2. å®‰è£ (Installation)

1.  **è¤‡è£½å°ˆæ¡ˆ**
    ```bash
    git clone https://github.com/956zs/discord-message-counter.git
    cd your-repo-name
    ```

2.  **å®‰è£ä¾è³´**
    ```bash
    npm install
    ```

3.  **è¨­å®šç’°å¢ƒè®Šæ•¸**
    -   è¤‡è£½ `.env.example` (å¦‚æœæœ‰çš„è©±) æˆ–æ‰‹å‹•å»ºç«‹ä¸€å€‹ `.env` æª”æ¡ˆã€‚
    -   å¡«å…¥ä»¥ä¸‹è³‡è¨Šï¼š

    ```env
    # .env

    # Discord æ©Ÿå™¨äººè¨­å®š
    DISCORD_TOKEN=ä½ çš„æ©Ÿå™¨äººTOKEN
    CLIENT_ID=ä½ çš„æ©Ÿå™¨äººCLIENT_ID

    # PostgreSQL è³‡æ–™åº«é€£ç·šè¨­å®š
    DB_HOST=localhost
    DB_PORT=5432
    DB_USER=postgres
    DB_PASSWORD=ä½ çš„è³‡æ–™åº«å¯†ç¢¼
    DB_DATABASE=discord_message_counter
    ```

### 3. è³‡æ–™åº«è¨­å®š (Database Setup)

é€£æ¥åˆ°ä½ çš„ PostgreSQL ä¼ºæœå™¨ (ä¾‹å¦‚ä½¿ç”¨ `psql` æˆ– DBeaver)ï¼Œä¸¦åŸ·è¡Œä»¥ä¸‹ SQL ä¾†å»ºç«‹å¿…è¦çš„è³‡æ–™åº«å’Œè³‡æ–™è¡¨ï¼š

1.  **å»ºç«‹è³‡æ–™åº«**
    ```sql
    CREATE DATABASE discord_message_counter;
    ```

2.  **é€£æ¥åˆ°æ–°è³‡æ–™åº«ä¸¦å»ºç«‹è³‡æ–™è¡¨**
    ```sql
    \c discord_message_counter

    -- å»ºç«‹è¨Šæ¯è¨ˆæ•¸è¡¨
    CREATE TABLE message_counts (
        user_id VARCHAR(255) NOT NULL,
        guild_id VARCHAR(255) NOT NULL,
        channel_id VARCHAR(255) NOT NULL,
        count BIGINT NOT NULL DEFAULT 0,
        PRIMARY KEY (user_id, guild_id, channel_id)
    );

    -- å»ºç«‹åŒæ­¥ç‹€æ…‹è¿½è¹¤è¡¨
    CREATE TABLE sync_status (
        guild_id VARCHAR(255) PRIMARY KEY,
        status VARCHAR(50) NOT NULL DEFAULT 'idle',
        last_synced_channel_id VARCHAR(255) NULL,
        last_updated TIMESTAMPTZ NOT NULL DEFAULT NOW()
    );
    ```

### 4. å•Ÿå‹•æ©Ÿå™¨äºº (Running the Bot)

å°ˆæ¡ˆæä¾›äº†æ–¹ä¾¿çš„ npm è…³æœ¬ï¼š

1.  **éƒ¨ç½²æ–œç·šæŒ‡ä»¤ (åªéœ€åŸ·è¡Œä¸€æ¬¡)**
    -   åœ¨å°‡æ©Ÿå™¨äººåŠ å…¥ä¼ºæœå™¨å¾Œï¼ŒåŸ·è¡Œæ­¤æŒ‡ä»¤ä¾†è¨»å†Šæ‰€æœ‰æ–œç·šæŒ‡ä»¤ã€‚
    ```bash
    npm run deploy
    ```

2.  **å•Ÿå‹•æ©Ÿå™¨äºº (é–‹ç™¼æ¨¡å¼)**
    -   æ­¤æ¨¡å¼ä¸‹ï¼Œæª”æ¡ˆè®Šæ›´æ™‚æœƒè‡ªå‹•é‡å•Ÿï¼Œæ–¹ä¾¿é–‹ç™¼ã€‚
    ```bash
    npm run dev
    ```

3.  **å•Ÿå‹•æ©Ÿå™¨äºº (æ­£å¼ç’°å¢ƒ)**
    -   æ­¤æ¨¡å¼æœƒå…ˆå°‡ TypeScript ç·¨è­¯æˆ JavaScriptï¼Œç„¶å¾Œå†åŸ·è¡Œã€‚
    ```bash
    npm run start
    ```

---

## ğŸ¤ è²¢ç» (Contributing)

æ­¡è¿æäº¤ Pull Requests æˆ– Issuesï¼å¦‚æœä½ æœ‰ä»»ä½•æ”¹é€²å»ºè­°æˆ–ç™¼ç¾äº† Bugï¼Œè«‹ä¸è¦çŒ¶è±«ï¼Œè®“æˆ‘å€‘ä¸€èµ·è®“é€™å€‹å°ˆæ¡ˆè®Šå¾—æ›´å¥½ã€‚

## ğŸ“„ æˆæ¬Š (License)

æœ¬å°ˆæ¡ˆæ¡ç”¨ [MIT License](LICENSE) æˆæ¬Šã€‚